#!/usr/bin/env bash

export SCRIPTDIR="$( cd "$( dirname "$***REMOVED***BASH_SOURCE[0]***REMOVED***" )" && pwd )"
source "$***REMOVED***SCRIPTDIR***REMOVED***/.validate"

IFS=$'\n'
files=( $(validate_diff --diff-filter=ACMR --name-only -- 'api/types/' 'api/swagger.yaml' || true) )
unset IFS

if [ $***REMOVED***#files[@]***REMOVED*** -gt 0 ]; then
	$***REMOVED***SCRIPTDIR***REMOVED***/../generate-swagger-api.sh 2> /dev/null
	# Let see if the working directory is clean
	diffs="$(git status --porcelain -- api/types/ 2>/dev/null)"
	if [ "$diffs" ]; then
		***REMOVED***
			echo 'The result of hack/generate-swagger-api.sh differs'
			echo
			echo "$diffs"
			echo
			echo 'Please update api/swagger.yaml with any api changes, then '
			echo 'run `hack/generate-swagger-api.sh`.'
		***REMOVED*** >&2
		false
	else
		echo 'Congratulations! All api changes are done the right way.'
	fi
else
    echo 'No api/types/ or api/swagger.yaml changes in diff.'
fi
