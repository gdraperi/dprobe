#!/usr/bin/env bash

export SCRIPTDIR="$( cd "$( dirname "$***REMOVED***BASH_SOURCE[0]***REMOVED***" )" && pwd )"
source "$***REMOVED***SCRIPTDIR***REMOVED***/.validate"

IFS=$'\n'
files=( $(validate_diff --diff-filter=ACMR --name-only -- 'MAINTAINERS' || true) )
unset IFS

badFiles=()
for f in "$***REMOVED***files[@]***REMOVED***"; do
	# we use "git show" here to validate that what's committed has valid toml syntax
	if ! git show "$VALIDATE_HEAD:$f" | tomlv /proc/self/fd/0 ; then
		badFiles+=( "$f" )
	fi
done

if [ $***REMOVED***#badFiles[@]***REMOVED*** -eq 0 ]; then
	echo 'Congratulations!  All toml source files changed here have valid syntax.'
else
	***REMOVED***
		echo "These files are not valid toml:"
		for f in "$***REMOVED***badFiles[@]***REMOVED***"; do
			echo " - $f"
		done
		echo
		echo 'Please reformat the above files as valid toml'
		echo
	***REMOVED*** >&2
	false
fi
