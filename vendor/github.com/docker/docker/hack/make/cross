#!/usr/bin/env bash
set -e

# if we have our linux/amd64 version compiled, let's symlink it in
if [ -x "$DEST/../binary-daemon/dockerd-$VERSION" ]; then
	arch=$(go env GOHOSTARCH)
	mkdir -p "$DEST/linux/$***REMOVED***arch***REMOVED***"
	(
		cd "$DEST/linux/$***REMOVED***arch***REMOVED***"
		ln -sf ../../../binary-daemon/* ./
	)
	echo "Created symlinks:" "$DEST/linux/$***REMOVED***arch***REMOVED***/"*
fi

DOCKER_CROSSPLATFORMS=$***REMOVED***DOCKER_CROSSPLATFORMS:-"linux/amd64 windows/amd64"***REMOVED***

for platform in $DOCKER_CROSSPLATFORMS; do
	(
		export KEEPDEST=1
		export DEST="$DEST/$platform" # bundles/VERSION/cross/GOOS/GOARCH/docker-VERSION
		export GOOS=$***REMOVED***platform%/****REMOVED***
		export GOARCH=$***REMOVED***platform##*/***REMOVED***

		echo "Cross building: $DEST"
		mkdir -p "$DEST"
		ABS_DEST="$(cd "$DEST" && pwd -P)"
		source "$***REMOVED***MAKEDIR***REMOVED***/binary-daemon"
	)
done
